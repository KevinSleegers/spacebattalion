function preload(){game.load.spritesheet("player","img/ally_sprite.png",64,64),game.load.image("boss","img/boss.png"),game.load.image("bullet","img/bullet.png"),game.load.audio("background",["audio/background.mp3","audio/background.ogg"]),game.load.audio("allyShot","audio/shot.wav")}function create(){this.stage.disableVisibilityChange=!0,playerName=prompt("What's your battle name?"),console.log(datum()+" | Welcome: "+playerName.charAt(0).toUpperCase()+playerName.substring(1)+"."),game.renderer.clearBeforeRender=!1,game.renderer.roundPixels=!0,game.physics.startSystem(Phaser.Physics.ARCADE),game.world.setBounds(0,0,2e3,2e3),background=game.add.audio("background"),background.play("",0,1,!0),bulletSound=game.add.audio("allyShot"),player=game.add.sprite(game.world.centerX,game.world.centerY,"player"),player.anchor.setTo(.5,.5),player.animations.add("fly"),player.animations.play("fly",10,!0),game.physics.enable(player,Phaser.Physics.ARCADE),player.enableBody=!0,player.body.collideWorldBounds=!0,game.camera.follow(player),textPlayer=game.add.text(game.world.centerX,50,"Player: "+playerName),textPlayer.font="Press Start 2P",textPlayer.fontSize=15,textPlayer.fill="#f00",textPlayer.align="center",textPlayer.anchor.setTo(.5,.5),textPlayer.fixedToCamera=!0,textBullets=game.add.text(window.screen.availWidth-150,50,"Bullets: "+bulletsCount),textBullets.font="Press Start 2P",textBullets.fontSize=15,textBullets.fill="#f00",textBullets.align="left",textBullets.anchor.setTo(.5,.5),textBullets.fixedToCamera=!0,textOnlinePlayers=game.add.text(180,0+window.screen.availHeight-200,"Online Players:\nYou ("+playerName+")"),textOnlinePlayers.font="Press Start 2P",textOnlinePlayers.fontSize=15,textOnlinePlayers.fill="#f00",textOnlinePlayers.align="left",textOnlinePlayers.anchor.setTo(.5,.5),textOnlinePlayers.fixedToCamera=!0,socket.emit("requestPlayers",io.socket.sessionid),socket.on("onlinePlayer",function(e){for(var a in e)newPlayer(e[a]),onlinePlayers.push(e[a].nickname);textOnlinePlayers.setText("Online Players:\nYou ("+playerName+")\n"+onlinePlayers.join("\n"))});var e=JSON.stringify({sessionid:io.socket.sessionid,nickname:playerName,x:game.world.centerX,y:game.world.centerY});socket.emit("newPlayer",e),socket.on("sendNewPlayer",function(e){console.log(datum()+" | Player: "+e.nickname.charAt(0).toUpperCase()+e.nickname.substring(1)+" has joined the game!"),newPlayer(e),onlinePlayers.push(e.nickname),textOnlinePlayers.setText("Online Players:\nYou ("+playerName+")\n"+onlinePlayers.join("\n"))}),socket.on("updatePlayer",function(e){updatePlayer(e)}),socket.on("removePlayer",function(e){console.log(datum()+" | Player: "+players[e].name.charAt(0).toUpperCase()+players[e].name.substring(1)+" has left the game!"),removePlayer(e);var a=onlinePlayers.indexOf(players[e].name);-1!=a&&onlinePlayers.splice(a,1),textOnlinePlayers.setText("Online Players:\nYou ("+playerName+")\n"+onlinePlayers.join("\n"))}),socket.on("newBullet",function(e){newBullet(e)}),boss=game.add.sprite(100,200,"boss"),boss.anchor.setTo(.5,.5),boss.enableBody=!0,game.physics.enable(boss,Phaser.Physics.ARCADE),boss.physicsBodyType=Phaser.Physics.ARCADE,bullets=game.add.group(),bullets.enableBody=!0,bullets.physicsBodyType=Phaser.Physics.ARCADE,bullets.createMultiple(bulletsCount,"bullet"),bullets.setAll("static",!0),bullets.setAll("anchor.x",.5),bullets.setAll("anchor.y",1),bullets.setAll("outOfBoundsKill",!0),otherBullets=game.add.group(),otherBullets.enableBody=!0,otherBullets.physicsBodyType=Phaser.Physics.ARCADE,otherBullets.setAll("anchor.x",.5),otherBullets.setAll("anchor.y",.5),otherBullets.setAll("outOfBoundsKill",!0),game.stage.backgroundColor="#000",game.input.addPointer(),fireButton=game.input.pointer1,game.device.desktop?cursors=game.input.keyboard.createCursorKeys():(navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate||null,vibrate=navigator.vibrate?!0:!1,gyro.hasFeature("devicemotion")?(console.log(datum()+" | Gyro.js loaded!"),gyro.getFeatures().length>0&&(gyro.frequency=10,gyro.startTracking(function(e){var a=Math.atan2(e.y,e.x);angleRadians=a*Math.PI/180,a*=180/Math.PI,a=180-a,fireButton.isDown&&fire(),e.z<9.5||e.z>10?changePosition("-",20*e.x,"+",20*e.y,game.math.wrapAngle(a,!1)):changePosition("","","","",0)}))):(console.log(datum()+" | Gyro.js not loaded!"),window.addEventListener("devicemotion",function(e){var a=e.accelerationIncludingGravity.x,t=e.accelerationIncludingGravity.y,o=e.accelerationIncludingGravity.z,n=Math.atan2(t,a);n*=180/Math.PI,n=180-n,fireButton.isDown&&fire(),9.5>o||o>10?changePosition("-",40*a,"+",40*t,game.math.wrapAngle(n,!1)):changePosition("","","","",0)})))}function update(){if(player.body.velocity.setTo(0,0),document.hasFocus()?1==game.sound.mute&&(game.sound.mute=!1):0==game.sound.mute&&(game.sound.mute=!0),game.device.desktop&&(cursors.left.isDown?cursors.left.isDown&&cursors.down.isDown?changePosition("-",diagonalSpeed(movementSpeed),"+",diagonalSpeed(movementSpeed),135):cursors.left.isDown&&cursors.up.isDown?changePosition("-",diagonalSpeed(movementSpeed),"-",diagonalSpeed(movementSpeed),-135):changePosition("-",movementSpeed,"","",180):cursors.right.isDown?cursors.right.isDown&&cursors.down.isDown?changePosition("+",diagonalSpeed(movementSpeed),"+",diagonalSpeed(movementSpeed),45):cursors.right.isDown&&cursors.up.isDown?changePosition("+",diagonalSpeed(movementSpeed),"-",diagonalSpeed(movementSpeed),-45):changePosition("+",movementSpeed,"","",0):cursors.up.isDown?changePosition("","","-",movementSpeed,-90):cursors.down.isDown&&changePosition("","","+",movementSpeed,90),game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).isDown&&fire(),game.physics.arcade.overlap(bullets,boss,bulletCollisionWithBoss,null,this)),shakeScreen>0){var e=game.rnd.integerInRange(-15,15),a=game.rnd.integerInRange(-15,15);game.world.setBounds(e,a,2e3+e,2e3+a),shakeScreen--,0==shakeScreen&&game.world.setBounds(0,0,2e3,2e3)}}function fire(){if(game.time.now>bulletTime&&(bullet=bullets.getFirstExists(!1))){0==player.angle||-90==player.angle?bullet.reset(player.body.x+42,player.body.y+42):bullet.reset(player.body.x+22,player.body.y+22),bullet.rotation=player.rotation,game.physics.arcade.velocityFromRotation(player.rotation,400,bullet.body.velocity),bulletTime=game.time.now+150,bulletSound.play(),1==vibrate&&navigator.vibrate(500),shakeScreen=20,bulletsCount--,textBullets.setText("Bullets: "+bulletsCount);var e=JSON.stringify({sessionid:io.socket.sessionid,rotation:bullet.rotation,nickname:playerName,x:bullet.x,y:bullet.y});socket.emit("bulletChange",e)}}function newPlayer(e){e.session,e.nickname,e.x,e.y;players[e.session]=game.add.sprite(e.x,e.y,"player"),players[e.session].anchor.setTo(.5,.5),players[e.session].animations.add("fly"),players[e.session].animations.play("fly",10,!0),game.physics.enable(players[e.session],Phaser.Physics.ARCADE),players[e.session].enableBody=!0,players[e.session].body.collideWorldBounds=!0,players[e.session].name=e.nickname}function updatePlayer(e){e.session,e.nickname,e.x,e.y,e.angle;players[e.session].x=e.x,players[e.session].y=e.y,players[e.session].angle=e.angle}function removePlayer(e){var a=e;players[a].kill()}function newBullet(e){otherBullets.createMultiple(1,"bullet");var a=otherBullets.getFirstExists(!1);a&&(a.reset(e.x,e.y),a.rotation=e.rotation,game.physics.arcade.velocityFromRotation(e.rotation,800,a.body.velocity),bulletSound.play(),bulletSound.volume=.5)}function changePosition(e,a,t,o,n){if(""==a?a=0:a,""==o?o=0:o,"+"==e?player.body.velocity.x+=a:"-"==e?player.body.velocity.x-=a:player.body.velocity.x+=0,"+"==t?player.body.velocity.y+=o:"-"==t?player.body.velocity.y-=o:player.body.velocity.y+=0,player.angle=n,oldX!==player.x||oldY!==player.y){var l=JSON.stringify({sessionid:io.socket.sessionid,nickname:playerName,x:player.x,y:player.y,angle:player.angle});(diffNumbers(player.x,oldX)>=1||diffNumbers(player.y,oldY)>=1)&&(socket.emit("positionChange",l),oldX=player.x,oldY=player.y)}}function bulletCollisionWithBoss(){bossHealth-=.5,bullet.destroy(),0==bossHealth&&(boss.destroy(),alert("UU KILLED DA BAWSSS"))}function diagonalSpeed(e){var a=Math.sqrt(2*Math.pow(e,2))/2;return a}function randName(){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;10>t;t++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}function diffNumbers(e,a){return Math.abs(e-a)}function datum(){var e=new Date,a=1==e.getMinutes().toString().length?"0"+e.getMinutes():e.getMinutes(),t=1==e.getSeconds().toString().length?"0"+e.getSeconds():e.getSeconds(),o=1==e.getHours().toString().length?"0"+e.getHours():e.getHours();return e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()+" "+o+":"+a+":"+t}function render(){game.debug.soundInfo(background,100,100)}var game=new Phaser.Game(window.screen.availWidth,window.screen.availHeight,Phaser.AUTO,"",{preload:preload,create:create,update:update,render:render}),io=io.connect("",{rememberTransport:!1,transports:["WebSocket","Flash Socket","AJAX long-polling"]}),player,boss,players={},playerName,onlinePlayers=[],cursors,fireButton,bullets,bulletTime=0,textBullets,textPlayer,bulletsCount=100,oldX=0,oldY=0,otherBullets,movementSpeed=350,diagonalSpeed,background,bulletSound,vibrate=!1,shakeScreen=0,bossHealth=100;