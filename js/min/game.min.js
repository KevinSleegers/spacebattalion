var io=io.connect("",{rememberTransport:!1,transports:["WebSocket","Flash Socket","AJAX long-polling"]}),player,boss,players={},coopPlayers={},playerName,onlinePlayers=[],cursors,fireButton,bullets,currentDirection,bulletsCount=20,bulletTime=0,textPlayers,curPlayerFrame,textScore,oldX=0,oldY=0,movementSpeed=350,diagonalSpeed,vibrate=!1,shakeScreen=0,bossHealth=100,muzzleFlash,playerType,bossIsDying=!1,playerGroup,bgtile,clouds,cloudTimer=0,stars,starTimer=0,moon,playerBullet,backgroundMusic,shipHitSound,latitude,longitude,range=500,coop,coopMovement=!1,coopShooting=!1,logging=!0,bounds=2e3;SpaceBattalion.Game=function(){this.game,this.add,this.camera,this.debug,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.state,this.world,this.particles,this.physics,this.renderer,this.rnd},SpaceBattalion.Game.prototype={create:function(){this.time.advancedTiming=!0,this.input.maxPointers=1,logging||(console.log=function(){}),this.physics.startSystem(Phaser.Physics.ARCADE),this.world.setBounds(0,0,bounds,bounds),this.backgroundMusic=this.add.audio("backgroundMusic"),SpaceBattalion.music&&this.backgroundMusic.play("",0,1,!0),this.shipHitSound=this.add.audio("shipHitSound"),this.laserShotSound=this.add.audio("laserShotSound"),this.explosionSound=this.add.audio("explosionSound"),playerName=prompt("What's your battle name?"),playerName||(playerName=this.randName()),bgtile=this.add.tileSprite(0,0,bounds,bounds,"mainBg"),null!==localStorage.getItem("latitude")&&null!==localStorage.getItem("longitude")&&(latitude=localStorage.getItem("latitude"),longitude=localStorage.getItem("longitude")),player=this.add.sprite(this.world.centerX,this.world.centerY,"player"),boss=this.add.sprite(100,200,"boss"),playerType="boss"===playerName?boss:player,player.anchor.setTo(.5,.5),player.name=io.socket.sessionid,player.allowControls=!0,player.latitude=latitude,player.longitude=longitude,player.coop=!1,player.move=!0,player.shoot=!0,player.health=100,player.bringToTop(),this.physics.enable(player,Phaser.Physics.ARCADE),player.physicsBodyType=Phaser.Physics.ARCADE,player.enableBody=!0,player.body.collideWorldBounds=!0,player.body.immovable=!0,player.score=0,player.frame=3,player.minion=!1,playerGroup=this.add.group(),playerGroup.add(player),playerGroup.bringToTop(player),boss.anchor.setTo(.5,.5),boss.allowControls=!0,boss.enableBody=!0,this.physics.enable(boss,Phaser.Physics.ARCADE),boss.physicsBodyType=Phaser.Physics.ARCADE,boss.health=1e3,boss.frame=1,boss.body.immovable=!0,boss.move=!0,this.camera.follow(playerType),bullets=this.add.group();for(var e=0;bulletsCount>e;e++){var o=this.add.sprite(0,0,"bullet");bullets.add(o),o.animations.add("bulletCollide",[1,2,3,4,5,6]),o.anchor.setTo(.5,.5),o.frame=0,this.physics.enable(o,Phaser.Physics.ARCADE),o.kill()}socket.emit("requestPlayers",io.socket.sessionid);var s=this;socket.on("onlinePlayer",function(e){0===Object.getOwnPropertyNames(e).length?console.log("There are no other players online."):(console.log("There are other players online."),socket.emit("getCoopPlayers",io.socket.sessionid));for(var o in e)e[o].session.length<=20&&(console.log("Creating player",e[o].session),s.createPlayer(e[o])),onlinePlayers.push(e[o].session)});var s=this;socket.on("onlineCoop",function(e){for(var o in e){var a=e[o].player1,i=e[o].player2,t=e[o].shoot,l=e[o].move,n=e[o].session,r=e[o].x,p=e[o].y,y=e[o].angle;a!==io.socket.sessionid&&i!==io.socket.sessionid&&(console.log("Creating new Co-op (other players)"),s.createCoop(i,a,t,l,n,r,p,y,"other"))}});var a=JSON.stringify({sessionid:io.socket.sessionid,nickname:playerName,x:this.world.centerX,y:this.world.centerY,lat:latitude,"long":longitude,angle:0});socket.emit("newPlayer",a);var s=this;socket.on("sendNewPlayer",function(e){s.createPlayer(e),onlinePlayers.push(e.session)});var s=this;socket.on("joinCoop",function(e){var o=JSON.parse(e),a=o.player1,i=o.player2,t=o.move,l=o.shoot;s.createCoop(a,i,t,l,"","","","join")});var s=this;socket.on("updatePlayer",function(e){s.updatePlayer(e)});var s=this;socket.on("removePlayer",function(e){s.removePlayer(e);var o=onlinePlayers.indexOf(players[e].name);-1!=o&&onlinePlayers.splice(o,1)});var s=this;socket.on("newBullet",function(e){s.createBullet(e)});var s=this;socket.on("playerShot",function(e){if(SpaceBattalion.music&&s.shipHitSound.play(),e===io.socket.sessionid)if(player.damage(10),console.log("ik wordt gehit"),player.minion===!1)if(player.health<=70&&player.health>30)player.frame=10,setTimeout(function(){player.frame=4},100);else if(player.health<=30&&player.health>0)player.frame=10,setTimeout(function(){player.frame=5},100);else if(player.health<=0)player.frame=10,setTimeout(function(){player.frame=9},100),player.alive=!0,player.exists=!0,player.visible=!0,socket.emit("playerDied",io.socket.sessionid),setTimeout(function(){s.explode(player.x,player.y),socket.emit("playerMinion",io.socket.sessionid)},1e3);else{var o=player.frame;player.frame=10,setTimeout(function(){player.frame=o},100)}else player.frame=11,setTimeout(function(){player.frame=12},100);else if(e.length>20){coopPlayers[e].damage(10);var a=coopPlayers[e].frame;coopPlayers[e].frame=0,setTimeout(function(){coopPlayers[e].frame=a},100),0===coopPlayers[e].health}else if(players[e].damage(10),players[e].minion===!1)if(players[e].health<=70&&players[e].health>30)players[e].frame=10,setTimeout(function(){players[e].frame=1},100);else if(players[e].health<=30&&players[e].health>0)players[e].frame=10,setTimeout(function(){players[e].frame=2},100);else if(players[e].health<=0)players[e].frame=10,setTimeout(function(){players[e].frame=9},100),players[e].alive=!0,players[e].exists=!0,players[e].visible=!0,setTimeout(function(){s.explode(players[e].x,players[e].y)},1e3);else{var o=players[e].frame;players[e].frame=10,setTimeout(function(){players[e].frame=o},100)}else players[e].frame=11,setTimeout(function(){players[e].frame=13},100)}),socket.on("minionPlayer",function(e){e===io.socket.sessionid?(player.revive(),player.frame=12,player.minion=!0,player.health=100):(players[e].revive(),players[e].frame=13,players[e].minion=!0,players[e].health=100)});var s=this;for(socket.on("bossDead",function(){s.explode(boss.x,boss.y)}),socket.on("updatedLocation",function(e){players[e.session].lat=e.lat,players[e.session].long=e.long}),clouds=this.add.group(),clouds.enableBody=!0,clouds.physicsBodyType=Phaser.Physics.ARCADE,clouds.setAll("anchor.x",.5),clouds.setAll("anchor.y",.5),clouds.setAll("outOfBoundsKill",!0),e=0;5>e;e++)this.createCloud();if(stars=this.add.group(),stars.enableBody=!0,stars.physicsBodyType=Phaser.Physics.ARCADE,stars.setAll("anchor.x",.5),stars.setAll("anchor.y",.5),stars.setAll("outOfBoundsKill",!0),this.createMoon(),this.game.device.desktop)cursors=this.input.keyboard.createCursorKeys();else{navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate||null,vibrate=navigator.vibrate?!0:!1;var s=this;gyro.hasFeature("devicemotion")&&(console.log("Gyro.js loaded!"),gyro.getFeatures().length>0&&(gyro.frequency=10,gyro.startTracking(function(e){var o=Math.atan2(e.y,e.x);angleRadians=o*Math.PI/180,o*=180/Math.PI,o-=90,o=s.math.wrapAngle(o),e.z<9||e.z>10.5?s.changePosition("-",20*e.y,"-",20*e.x,o,"p"):s.changePosition("","","","",0,"p")})))}},update:function(){var e=this;window.onblur=function(){e.backgroundMusic.pause()};var e=this;if(window.onfocus=function(){e.backgroundMusic.resume()},0!==Object.getOwnPropertyNames(coopPlayers).length?Object.keys(coopPlayers).forEach(function(e){e.indexOf(io.socket.sessionid)>-1?coopPlayers[e].body.velocity.setTo(0,0):playerType.body.velocity.setTo(0,0)}):playerType===boss?playerType.body.velocity.setTo(0,0):"undefined"!=typeof player&&player.body.velocity.setTo(0,0),moon.x>this.world.width+moon.width&&(moon.destroy(),this.createMoon()),this.game.device.desktop){if(bgtile.tilePosition.x-=2,bgtile.tilePosition.y+=1,this.time.now>cloudTimer&&this.createCloud(),this.time.now>starTimer&&this.createStar(),"undefined"!=typeof player&&player.visible===!0&&player.coop===!1){var o="p";movementSpeed=350}else{var o="c";movementSpeed=175}("undefined"!=typeof player&&player.move===!0||coopMovement===!0)&&(Object.keys(coopPlayers).forEach(function(e){e.indexOf(io.socket.sessionid)>-1&&(o=e)}),cursors.left.isDown?cursors.left.isDown&&cursors.down.isDown?(this.changePosition("-",this.diagonalSpeed(movementSpeed),"+",this.diagonalSpeed(movementSpeed),135,o),currentDirection="left-down"):cursors.left.isDown&&cursors.up.isDown?(this.changePosition("-",this.diagonalSpeed(movementSpeed),"-",this.diagonalSpeed(movementSpeed),-135,o),currentDirection="left-up"):(this.changePosition("-",movementSpeed,"","",180,o),currentDirection="left"):cursors.right.isDown?cursors.right.isDown&&cursors.down.isDown?(this.changePosition("+",this.diagonalSpeed(movementSpeed),"+",this.diagonalSpeed(movementSpeed),45,o),currentDirection="right-down"):cursors.right.isDown&&cursors.up.isDown?(this.changePosition("+",this.diagonalSpeed(movementSpeed),"-",this.diagonalSpeed(movementSpeed),-45,o),currentDirection="right-up"):(this.changePosition("+",movementSpeed,"","",0,o),currentDirection="right"):cursors.up.isDown?(this.changePosition("","","-",movementSpeed,-90,o),currentDirection="up"):cursors.down.isDown&&(this.changePosition("","","+",movementSpeed,90,o),currentDirection="down")),("undefined"!=typeof player&&player.shoot===!0||coopShooting===!0)&&this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).isDown&&(this.fire(null),console.log("aaa"))}else clouds.length>=10?(console.log("meer dan 10 wolken.. "),clouds.removeAll()):this.time.now>cloudTimer&&this.createCloud(),stars.length>=15?(console.log("meer dan 15 sterren.. "),stars.removeAll()):this.time.now>starTimer&&this.createStar(),this.input.onTap.add(this.tapScreen,this);for(var s in players)players[s].visible!==!1&&this.physics.arcade.collide(bullets,players[s],this.bulletOtherPlayer,null,this),player.visible!==!1&&this.physics.arcade.collide(bullets,player,this.bulletPlayer,null,this);for(var s in coopPlayers)this.physics.arcade.collide(bullets,coopPlayers[s],this.bulletCoop,null,this);this.physics.arcade.collide(bullets,boss,this.bulletBoss,null,this),this.physics.arcade.overlap(player,boss,this.overlapPlayer,null,this)},createPlayer:function(e){e.session,e.nickname,e.x,e.y,e.angle;players[e.session]=this.add.sprite(e.x,e.y,"player"),players[e.session].anchor.setTo(.5,.5),this.physics.enable(players[e.session],Phaser.Physics.ARCADE),players[e.session].enableBody=!0,players[e.session].body.collideWorldBounds=!0,players[e.session].name=e.session,players[e.session].health=100,players[e.session].minion=!1,players[e.session].angle=e.angle,players[e.session].body.immovable=!0,"undefined"!=typeof e.minion&&(e.minion===!0?(players[e.session].minion=!0,players[e.session].frame=13):(players[e.session].minion=!1,players[e.session].frame=0)),players[e.session].latitude=e.lat,players[e.session].longitude=e.long,players[e.session].coop=!1,players[e.session].coopPlayer="",players[e.session].inputEnabled=!0,players[e.session].events.onInputDown.add(this.clickedPlayer,this),"undefined"!=typeof e.coop&&e.coop===!0&&(players[e.session].visible=!1),playerGroup.add(players[e.session]),playerGroup.bringToTop(player)},createCoop:function(e,o,s,a,i,t,l,n){if(coopSession="new"==n?e+o:o+e,(e===io.socket.sessionid||o===io.socket.sessionid)&&(player.coop=!0),coopPlayers[coopSession]=this.add.sprite(this.world.centerX,this.world.centerY,"coop"),coopPlayers[coopSession].name=coopSession,coopPlayers[coopSession].player1=e,coopPlayers[coopSession].player2=o,coopPlayers[coopSession].coopSession=coopSession,coopPlayers[coopSession].move=a,coopPlayers[coopSession].shoot=s,coopPlayers[coopSession].anchor.setTo(.5,.5),coopPlayers[coopSession].enableBody=!0,this.physics.enable(coopPlayers[coopSession],Phaser.Physics.ARCADE),coopPlayers[coopSession].physicsBodyType=Phaser.Physics.ARCADE,coopPlayers[coopSession].health=250,coopPlayers[coopSession].frame=3,coopPlayers[coopSession].body.collideWorldBounds=!0,coopPlayers[coopSession].body.immovable=!0,""!==i&&""!==t&&""!==l&&(coopPlayers[coopSession].x=i,coopPlayers[coopSession].y=t,coopPlayers[coopSession].angle=l),coopPlayers[coopSession].move==io.socket.sessionid&&(coopPlayers[coopSession].frame=2,coopMovement=!0,coopShooting=!1),coopPlayers[coopSession].shoot==io.socket.sessionid&&(coopPlayers[coopSession].frame=1,coopShooting=!0,coopMovement=!1,player.move=!1),e===io.socket.sessionid?("undefined"!=typeof player&&(player.coop=!0,player.visible=!1,player.renderable=!1,player.allowControls=!1,player.move=!1,player.shoot=!1,player.enableBody=!1),"undefined"!=typeof players[o]&&(players[o].visible=!1,players[o].coop=!0,players[o].renderable=!1,players[o].enableBody=!1),this.camera.follow(coopPlayers[coopSession])):o===io.socket.sessionid?("undefined"!=typeof player&&(player.coop=!0,player.visible=!1,player.renderable=!1,player.allowControls=!1,player.move=!1,player.shoot=!1,player.enableBody=!1),"undefined"!=typeof players[e]&&(players[e].visible=!1,players[e].coop=!0,players[e].renderable=!1,players[e].enableBody=!1),this.camera.follow(coopPlayers[coopSession])):("undefined"!=typeof players[e]&&(players[e].visible=!1,players[e].coop=!0,players[e].renderable=!1,players[e].enableBody=!1),"undefined"!=typeof players[o]&&(players[o].visible=!1,players[o].coop=!0,players[o].renderable=!1,players[o].enableBody=!1)),"new"===n){var r=JSON.stringify({player1:o,player2:e,move:o,shoot:e,x:coopPlayers[coopSession].x,y:coopPlayers[coopSession].y,angle:coopPlayers[coopSession].angle});socket.emit("newCoop",r)}},updatePlayer:function(e){"boss"===e.nickname?(boss.x=e.x,boss.y=e.y,boss.angle=e.angle):"coop"===e.nickname?(coopPlayers[e.session].x=e.x,coopPlayers[e.session].y=e.y,coopPlayers[e.session].angle=e.angle):(players[e.session].x=e.x,players[e.session].y=e.y,players[e.session].angle=e.angle)},fire:function(e){if(this.time.now>bulletTime){if(bulletTime=this.time.now+250,player.coop===!0)var o=coopPlayers[coopSession].body.x+coopPlayers[coopSession].width/2,s=coopPlayers[coopSession].body.y+coopPlayers[coopSession].height/2,a=coopPlayers[coopSession].rotation,i=-0.2*Math.random()+.1,t=Math.floor(40*Math.random()+-20);else{if("left"===e)var o=playerType.body.x+.25*playerType.width,s=playerType.body.y+.25*playerType.height,i=0,t=0;else if("right"===e)var o=playerType.body.x+.75*playerType.width,s=playerType.body.y+.75*playerType.height,i=0,t=0;else var o=playerType.body.x+playerType.width/2,s=playerType.body.y+playerType.height/2,i=-0.2*Math.random()+.1,t=Math.floor(40*Math.random()+-20);var a=playerType.rotation}var l=JSON.stringify({sessionid:io.socket.sessionid,rotation:a,nickname:playerName,resetX:o,resetY:s,bulletY:t,randVelocity:i});socket.emit("bulletChange",l),SpaceBattalion.music&&this.laserShotSound.play()}},explode:function(e,o){explosion=this.add.sprite(e,o,"explosion"),explosion.anchor.setTo(.5,.5),explosion.alpha=0,this.add.tween(explosion).to({alpha:1},100,Phaser.Easing.Linear.None,!0,0,100,!0),explosion.animations.add("explosion"),explosion.play("explosion","",!1,!0),SpaceBattalion.music&&this.explosionSound.play()},bulletOtherPlayer:function(e,o){o.animations.play("bulletCollide"),o.events.onAnimationComplete.add(function(){o.kill()},this),socket.emit("damagePlayer",players[e.name].name)},bulletPlayer:function(e,o){o.animations.play("bulletCollide"),o.events.onAnimationComplete.add(function(){o.kill()},this)},bulletCoop:function(e,o){e.animations.play("bulletCollide"),e.events.onAnimationComplete.add(function(){e.kill()},this),socket.emit("damagePlayer",coopPlayers[o.name].name)},bulletBoss:function(e,o){if(!bossIsDying){if(o.session===io.socket.sessionid)if(player.minion===!1){player.score+=10;var s=!1}else var s=!0;else if(players[o.session].minion===!1)var s=!1;else var s=!0;if(s===!1){if(boss.damage(100),boss.frame=0,boss.health<=500&&boss.health>200)boss.tint=16750899;else if(boss.health<=200&&boss.health>0)boss.tint=16711680;else if(boss.health<=0){bossIsDying=!0,boss.tint=16777215,boss.alive=!0,boss.visible=!0,boss.exists=!0,boss.animations.add("boss"),boss.animations.play("boss",8,!1,!0);var a=this;boss.events.onAnimationComplete.add(function(){socket.emit("bossDied",io.socket.sessionid),setTimeout(function(){a.state.start("GameEnd")},500)})}setTimeout(function(){boss.frame=1},100)}}o.animations.play("bulletCollide"),o.events.onAnimationComplete.add(function(){o.kill()},this),SpaceBattalion.music&&this.shipHitSound.play()},overlapPlayer:function(e,o){e.minion===!1&&o.move===!0&&playerType!==o&&(e.name===io.socket.sessionid?(player.minion=!0,player.frame=12,player.health=100,socket.emit("playerMinion",io.socket.sessionid)):(players[e.name].minion=!0,players[e.name].frame=12,players[e.name].health=100))},clickedPlayer:function(e){this.compareGPS(players[e.name].latitude,players[e.name].longitude,players[e.name].name)},tapScreen:function(e){e.pageX>=0&&e.pageX<=SpaceBattalion.windowWidth/2?this.fire("left"):this.fire("right")},changePosition:function(e,o,s,a,i,t){if("p"===t){if(""==o?o=0:o,""==a?a=0:a,"+"==e?playerType.body.velocity.x+=o:"-"==e?playerType.body.velocity.x-=o:playerType.body.velocity.x+=0,"+"==s?playerType.body.velocity.y+=a:"-"==s?playerType.body.velocity.y-=a:playerType.body.velocity.y+=0,playerType.angle=i,oldX!==playerType.x||oldY!==playerType.y){this.game.device.desktop&&(emitter=this.add.emitter(playerType.x,playerType.y,1),emitter.makeParticles("flyRail"),emitter.setRotation(0,0),emitter.setAlpha(.3,.8),emitter.setScale(.8,3),emitter.gravity=400,emitter.start(!0,150,100)),this.world.bringToTop(playerGroup);var l=JSON.stringify({sessionid:io.socket.sessionid,nickname:playerName,x:playerType.x,y:playerType.y,angle:playerType.angle});(this.diffNumbers(playerType.x,oldX)>=1||this.diffNumbers(playerType.y,oldY)>=1)&&(socket.emit("positionChange",l),oldX=playerType.x,oldY=playerType.y)}}else if(""==o?o=0:o,""==a?a=0:a,"+"==e?coopPlayers[t].body.velocity.x+=o:"-"==e?coopPlayers[t].body.velocity.x-=o:coopPlayers[t].body.velocity.x+=0,"+"==s?coopPlayers[t].body.velocity.y+=a:"-"==s?coopPlayers[t].body.velocity.y-=a:coopPlayers[t].body.velocity.y+=0,coopPlayers[t].angle=i,oldX!==coopPlayers[t].x||oldY!==coopPlayers[t].y){var l=JSON.stringify({sessionid:coopSession,nickname:"coop",x:coopPlayers[t].x,y:coopPlayers[t].y,angle:coopPlayers[t].angle});(this.diffNumbers(coopPlayers[t].x,oldX)>=1||this.diffNumbers(coopPlayers[t].y,oldY)>=1)&&(socket.emit("positionChange",l),oldX=coopPlayers[t].x,oldY=coopPlayers[t].y)}},createCloud:function(){var e=Math.floor(10*Math.random()+1);if(5>e)var o=this.add.sprite(this.world.randomX,this.world.randomY,"cloud1");else var o=this.add.sprite(this.world.randomX,this.world.randomY,"cloud2");o.alpha=0,o.angle=this.rnd.angle(),this.add.tween(o).to({alpha:1},2e3,Phaser.Easing.Linear.None).to({x:this.game.width+(1600+o.x)},15e4,Phaser.Easing.Linear.None).to({angle:o.angle},15e4,Phaser.Easing.Linear.None).start(),cloudTimer=this.time.now+5e3,clouds.add(o)},createStar:function(){var e=this.add.sprite(this.world.randomX,this.world.randomY,"star");e.alpha=0,e.angle=this.rnd.angle(),this.add.tween(e).to({alpha:1},1e3,Phaser.Easing.Linear.None).start(),starTimer=this.time.now+3e3,stars.add(e)},createMoon:function(){var e=this.world.randomY;300>e?e+=164:e>1700?e-=164:e=e,moon=this.add.sprite(this.world.randomX,e,"moon"),moon.alpha=0,moon.angle=this.rnd.angle(),this.add.tween(moon).to({alpha:1},1e3,Phaser.Easing.Linear.None).to({x:this.game.width+(1600+moon.x)},3e5,Phaser.Easing.Linear.None).to({angle:moon.angle},15e4,Phaser.Easing.Linear.None).start()},removePlayer:function(e){e!==io.socket.sessionid&&(0!==Object.getOwnPropertyNames(coopPlayers).length?Object.keys(coopPlayers).forEach(function(e){e.indexOf(io.socket.sessionid)>-1&&(coopPlayers[e].kill(),player.visible=!0,player.allowControls=!0,player.move=!0,player.shoot=!0,player.enableBody=!0,this.camera.follow(playerType,Phaser.Camera.FOLLOW_TOPDOWN),coopMovement=!1,player.coop=!1,Object.keys(coopPlayers).forEach(function(o){o.indexOf(e)>-1&&delete coopPlayers[e]}))}):players[e].kill())},createBullet:function(e){var o=bullets.getFirstDead();o&&(o.revive(),this.game.device.desktop&&(muzzleFlash=this.add.sprite(e.resetX,e.resetY,"muzzleFlash"),"left"==currentDirection?muzzleFlash.anchor.setTo(1.9,.4):"left-up"==currentDirection?muzzleFlash.anchor.setTo(2.2,2.1):"left-down"==currentDirection?muzzleFlash.anchor.setTo(2.2,-1.4):"right-up"==currentDirection?muzzleFlash.anchor.setTo(-1.2,2.1):"right-down"==currentDirection?muzzleFlash.anchor.setTo(-1.2,-1.2):"right"==currentDirection?muzzleFlash.anchor.setTo(-.9,.6):"down"==currentDirection?muzzleFlash.anchor.setTo(.5,-1):"up"==currentDirection?muzzleFlash.anchor.setTo(.5,1.9):muzzleFlash.anchor.setTo(.5,.5),muzzleFlash.alpha=0,this.add.tween(muzzleFlash).to({alpha:1},100,Phaser.Easing.Linear.None,!0,0,100,!0),muzzleFlash.lifespan=200),o.checkWorldBounds=!0,o.outOfBoundsKill=!0,o.reset(e.resetX,e.resetY),o.rotation=e.rotation,o.y+=e.bulletY,o.session=e.session,this.physics.arcade.velocityFromRotation(e.rotation+=e.randVelocity,625,o.body.velocity),o.animations.add("bulletCollide"),shakeScreen=15)},diagonalSpeed:function(e){var o=Math.sqrt(2*Math.pow(e,2))/2;return o},compareGPS:function(e,o,s){if(""!==e&&""!==o){var a=this.distance(latitude,longitude,e,o,"k");a=1e3*a,s!=io.socket.sessionid?(console.log("Distance between YOU and "+s+" is: "+a.toString()+" meters."),player.coop===!1&&(console.log("Ik ben nog niet in co-op modus"),players[s].coop===!1&&(console.log(s+" is ook nog niet in co-op modus"),this.createCoop(player.name,players[s].name,players[s].name,player.name,"","","","new")))):console.log("Distance between YOU and "+players[s].name+" ("+a+") is greater than the given range ("+range+").")}},getLocation:function(){navigator.geolocation?navigator.geolocation.watchPosition(this.foundPosition,function(e){e.code==e.PERMISSION_DENIED&&(latitude=0,longitude=0)},{enableHighAccuracy:!1}):console.log("Het ophalen van uw locatie is mislukt\nGPS wordt niet ondersteund op uw smart device.")},foundPosition:function(e){if(e.coords.latitude!==latitude||e.coords.longitude!==longitude){latitude=position.coords.latitude,longitude=position.coords.longitude;var o=JSON.stringify({sessionid:io.socket.sessionid,lat:latitude,"long":longitude});socket.emit("locationUpdate",o)}},distance:function(e,o,s,a,i){var t=Math.PI*e/180,l=Math.PI*s/180,n=(Math.PI*o/180,Math.PI*a/180,o-a),r=Math.PI*n/180,p=Math.sin(t)*Math.sin(l)+Math.cos(t)*Math.cos(l)*Math.cos(r);return p=Math.acos(p),p=180*p/Math.PI,p=60*p*1.1515,"K"==i&&(p=1.609344*p),"N"==i&&(p=.8684*p),p},randName:function(){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=0;10>s;s++)e+=o.charAt(Math.floor(Math.random()*o.length));return e},diffNumbers:function(e,o){return Math.abs(e-o)},render:function(){this.game.debug.text("FPS: "+this.time.fps,80,150,"rgb(255,255,255)","24px Courier")},shutdown:function(){this.world.removeAll()}};