function preload(){game.load.script("webfont","//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"),game.load.spritesheet("player","assets/img/spr_plane_strip11.png",64,64),game.load.spritesheet("otherPlayers","assets/img/spr_plane_strip2.png",64,64),game.load.spritesheet("boss","assets/img/spr_boss_die_strip13_hor.png",128,256),game.load.spritesheet("coop","assets/img/spr_double_final_strip4.png",96,128),game.load.spritesheet("minion","assets/img/spr_minion_strip3.png",64,64),game.load.spritesheet("explosion","assets/img/fx_explosion_strip10.png",64,64),game.load.spritesheet("bullet","assets/img/fx_bullet_impact_strip7.png",32,32),game.load.image("star","assets/img/spr_star.png"),game.load.image("muzzleFlash","assets/img/spr_muzzleFlash.png"),game.load.image("flyRail","assets/img/fly_rail.png"),game.load.spritesheet("mainBg","assets/img/_spr_backgroundOverlay.png",160,160),game.load.image("cloud1","assets/img/spr_cloud1.png"),game.load.image("cloud2","assets/img/spr_cloud2.png"),game.load.image("moon","assets/img/spr_moon.png"),game.load.image("portraitMode","assets/img/portrait_mode.png"),game.load.audio("backgroundMusic",["assets/audio/TakingFlight.mp3","assets/audio/TakingFlight.ogg"])}function createText(){if("undefined"==typeof playerName&&(playerName="Onbekend"),textPlayers=game.add.text(180,50,"Players: "+(onlinePlayers.length+1)+"/40"),textPlayers.font="Press Start 2P",textPlayers.fontSize=15,textPlayers.fill="#d77e00",textPlayers.align="center",textPlayers.anchor.setTo(.5,.5),textPlayers.fixedToCamera=!0,"undefined"!=typeof player)var e=player.score;else var e=0;textScore=game.add.text(window.screen.availWidth-200,50,"Score: "+e),textScore.font="Press Start 2P",textScore.fontSize=15,textScore.fill="#d77e00",textScore.align="center",textScore.anchor.setTo(.5,.5),textScore.fixedToCamera=!0}function create(){for(logging===!1&&(console.log=function(){}),getLocation(),game.input.maxPointers=1,game.stage.disableVisibilityChange=!0,game.device.desktop?(game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.minWidth=w/2,game.scale.minHeight=h/2,game.scale.maxWidth=w,game.scale.maxHeight=h,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.setScreenSize(!0)):(game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.minWidth=w/2,game.scale.minHeight=h/2,game.scale.maxWidth=2.5*w,game.scale.maxHeight=2.5*h,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.forceOrientation(!0,!1),game.scale.hasResized.add(resizeGame,this),game.scale.forceOrientation(!0,!1,"portraitMode"),game.scale.leaveIncorrectOrientation.add(resizeGame,this),game.scale.setScreenSize(!0)),game.renderer.clearBeforeRender=!1,game.renderer.roundPixels=!0,game.physics.startSystem(Phaser.Physics.ARCADE),game.world.setBounds(0,0,5e3,5e3),bgtile=game.add.tileSprite(0,0,5e3,5e3,"mainBg"),null!==localStorage.getItem("latitude")&&null!==localStorage.getItem("longitude")&&(latitude=localStorage.getItem("latitude"),longitude=localStorage.getItem("longitude")),clouds=game.add.group(),clouds.enableBody=!0,clouds.physicsBodyType=Phaser.Physics.ARCADE,clouds.setAll("anchor.x",.5),clouds.setAll("anchor.y",.5),clouds.setAll("outOfBoundsKill",!0),stars=game.add.group(),stars.enableBody=!0,stars.physicsBodyType=Phaser.Physics.ARCADE,stars.setAll("anchor.x",.5),stars.setAll("anchor.y",.5),stars.setAll("outOfBoundsKill",!0),createStar(),e=0;5>e;e++)createCloud();createMoon(),playerName=prompt("What's your battle name?"),playerName||(playerName=randName()),console.log(currentDate()+" | Welcome: "+playerName.charAt(0).toUpperCase()+playerName.substring(1)+", your session is: "+io.socket.sessionid+"."),""!==playerName&&"undefined"!=typeof textPlayers&&textPlayers.setText("Player: "+playerName),backgroundMusic=game.add.audio("backgroundMusic"),bullets=game.add.group();for(var e=0;bulletsCount>e;e++){var o=this.game.add.sprite(0,0,"bullet");bullets.add(o),o.animations.add("bulletCollide",[1,2,3,4,5,6]),o.anchor.setTo(.5,.5),o.frame=0,console.log("bullet frame",o.frame),this.game.physics.enable(o,Phaser.Physics.ARCADE),o.kill()}playerGroup=game.add.group(),player=game.add.sprite(game.world.centerX,game.world.centerY,"player"),player.anchor.setTo(.5,.5),player.name=io.socket.sessionid,player.allowControls=!0,player.latitude=latitude,player.longitude=longitude,player.coop=!1,player.move=!0,player.shoot=!0,player.health=100,player.bringToTop(),game.physics.enable(player,Phaser.Physics.ARCADE),player.enableBody=!0,player.body.collideWorldBounds=!0,player.body.immovable=!0,player.score=0,boss=game.add.sprite(100,100,"boss"),boss.anchor.setTo(.5,.5),boss.allowControls=!0,boss.enableBody=!0,game.physics.enable(boss,Phaser.Physics.ARCADE),boss.physicsBodyType=Phaser.Physics.ARCADE,boss.health=1e3,boss.frame=1,boss.body.immovable=!0,playerType="boss"==playerName?boss:player,playerGroup.add(player),playerGroup.bringToTop(player),game.camera.follow(playerType,Phaser.Camera.FOLLOW_TOPDOWN),socket.emit("requestPlayers",io.socket.sessionid),socket.on("onlinePlayer",function(e){0===Object.getOwnPropertyNames(e).length?console.log(currentDate()+" | There are no other players online."):(console.log(currentDate()+" | There are other players online."),socket.emit("getCoopPlayers",io.socket.sessionid));for(var o in e)e[o].session.length<=20&&(console.log("Creating player",e[o].session),newPlayer(e[o])),onlinePlayers.push(e[o].session);"undefined"!=typeof textPlayers&&textPlayers.setText("Players: "+(onlinePlayers.length+1)+"/40")}),socket.on("onlineCoop",function(e){for(var o in e){var a=e[o].player1,s=e[o].player2,l=e[o].shoot,n=e[o].move,r=e[o].session,t=e[o].x,i=e[o].y,c=e[o].angle;a!==io.socket.sessionid&&s!==io.socket.sessionid&&(console.log("Creating new Co-op (other players)"),newCoop(s,a,l,n,r,t,i,c,"other"))}console.log("Online coop-players",e)});var a=JSON.stringify({sessionid:io.socket.sessionid,nickname:playerName,x:game.world.centerX,y:game.world.centerY,lat:latitude,"long":longitude,angle:0});socket.emit("newPlayer",a),socket.on("sendNewPlayer",function(e){console.log("Getting a new player",e),console.log(currentDate()+" | Player: "+e.nickname.charAt(0).toUpperCase()+e.nickname.substring(1)+" has joined the game!"),newPlayer(e),onlinePlayers.push(e.session),textPlayers.setText("Players: "+(onlinePlayers.length+1)+"/40")}),socket.on("joinCoop",function(e){var o=JSON.parse(e),a=o.player1,s=o.player2,l=o.move,n=o.shoot;console.log("Creating new Co-op (joined)"),newCoop(a,s,l,n,"","","","join")}),socket.on("notCoop",function(e){for(var o in e);}),socket.on("updatePlayer",function(e){updatePlayer(e)}),socket.on("playerShot",function(e){if(e===io.socket.sessionid)player.damage(10),console.log("ik wordt gehit"),player.health<=70&&player.health>30?(player.frame=4,player.tint=16750899):player.health<=30&&player.health>0?(player.frame=5,player.tint=16724736):player.health<=0?(player.alive=!0,player.exists=!0,player.visible=!0,setTimeout(function(){explode(player.x,player.y)},300),socket.emit("playerDied",io.socket.sessionid)):player.frame=3;else if(e.length>20){coopPlayers[e].damage(10);var o=coopPlayers[e].frame;coopPlayers[e].frame=0,setTimeout(function(){coopPlayers[e].frame=o},100),0===coopPlayers[e].health}else players[e].damage(10),players[e].health<=0&&explode(players[e].x,players[e].y)}),socket.on("removePlayer",function(e){console.log("remove",e),removePlayer(e);var o=onlinePlayers.indexOf(players[e].name);-1!=o&&onlinePlayers.splice(o,1),textPlayers.setText("Players: "+(onlinePlayers.length+1)+"/40")}),socket.on("bossDead",function(){explode(boss.x,boss.y)}),socket.on("updatedLocation",function(e){players[e.session].lat=e.lat,players[e.session].long=e.long}),socket.on("newBullet",function(e){newBullet(e)}),game.input.addPointer(),fireButton=game.input.pointer1,game.device.desktop?cursors=game.input.keyboard.createCursorKeys():(console.log("niet op desktop"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate||null,vibrate=navigator.vibrate?!0:!1,gyro.hasFeature("devicemotion")?(console.log(currentDate()+" | Gyro.js loaded!"),gyro.getFeatures().length>0&&(gyro.frequency=10,gyro.startTracking(function(e){var o=Math.atan2(e.y,e.x);angleRadians=o*Math.PI/180,o*=180/Math.PI,o=o,fireButton.isDown&&fire(),e.z<9.5||e.z>10?changePosition("-",20*e.y,"-",20*e.x,game.math.wrapAngle(o,!1),"p"):changePosition("","","","",0,"p")}))):(console.log(currentDate()+" | Gyro.js not loaded!"),window.addEventListener("devicemotion",function(e){var o=e.accelerationIncludingGravity.x,a=e.accelerationIncludingGravity.y,s=e.accelerationIncludingGravity.z,l=Math.atan2(a,o);l*=180/Math.PI,l=180-l,fireButton.isDown&&fire(),9.5>s||s>10?changePosition("-",40*o,"+",40*a,game.math.wrapAngle(l,!1),"p"):changePosition("","","","",0,"p")})))}function update(){if(0!==Object.getOwnPropertyNames(coopPlayers).length?Object.keys(coopPlayers).forEach(function(e){e.indexOf(io.socket.sessionid)>-1&&coopPlayers[e].body.velocity.setTo(0,0)}):playerType===boss?playerType.body.velocity.setTo(0,0):"undefined"!=typeof player&&player.body.velocity.setTo(0,0),game.device.desktop&&(bgtile.tilePosition.x-=1,bgtile.tilePosition.y+=.5),game.time.now>cloudTimer&&createCloud(),game.time.now>starTimer&&createStar(),moon.x>game.world.width+moon.width&&(moon.destroy(),createMoon()),document.hasFocus()?1==game.sound.mute&&(game.sound.mute=!1):0==game.sound.mute&&(game.sound.mute=!0),game.device.desktop){if("undefined"!=typeof player&&player.visible===!0&&player.coop===!1){var e="p";movementSpeed=350}else{var e="c";movementSpeed=175}("undefined"!=typeof player&&player.move===!0||coopMovement===!0)&&(Object.keys(coopPlayers).forEach(function(o){o.indexOf(io.socket.sessionid)>-1&&(e=o)}),cursors.left.isDown?cursors.left.isDown&&cursors.down.isDown?(changePosition("-",diagonalSpeed(movementSpeed),"+",diagonalSpeed(movementSpeed),135,e),currentDirection="left-down"):cursors.left.isDown&&cursors.up.isDown?(changePosition("-",diagonalSpeed(movementSpeed),"-",diagonalSpeed(movementSpeed),-135,e),currentDirection="left-up"):(changePosition("-",movementSpeed,"","",180,e),currentDirection="left"):cursors.right.isDown?cursors.right.isDown&&cursors.down.isDown?(changePosition("+",diagonalSpeed(movementSpeed),"+",diagonalSpeed(movementSpeed),45,e),currentDirection="right-down"):cursors.right.isDown&&cursors.up.isDown?(changePosition("+",diagonalSpeed(movementSpeed),"-",diagonalSpeed(movementSpeed),-45,e),currentDirection="right-up"):(changePosition("+",movementSpeed,"","",0,e),currentDirection="right"):cursors.up.isDown?(changePosition("","","-",movementSpeed,-90,e),currentDirection="up"):cursors.down.isDown&&(changePosition("","","+",movementSpeed,90,e),currentDirection="down")),("undefined"!=typeof player&&player.shoot===!0||coopShooting===!0)&&game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).isDown&&fire();for(var o in players)players[o].visible!==!1&&game.physics.arcade.collide(bullets,players[o],bulletOtherPlayer,null,this),player.visible!==!1&&game.physics.arcade.collide(bullets,player,bulletPlayer,null,this);for(var o in coopPlayers)game.physics.arcade.collide(bullets,coopPlayers[o],bulletCoop,null,this);game.physics.arcade.collide(bullets,boss,bulletBoss,null,this),game.physics.arcade.overlap(player,boss,overlapPlayer,null,this)}else game.input.onTap.add(tapped,this);if(shakeScreen>0){var a=game.rnd.integerInRange(-5,5),s=game.rnd.integerInRange(-5,5);game.world.setBounds(a,s,5e3+a,5e3+s),shakeScreen--,0==shakeScreen&&game.world.setBounds(0,0,5e3,5e3)}}function fire(){if(game.time.now>bulletTime){if(bulletTime=game.time.now+250,player.coop===!0)var e=coopPlayers[coopSession].body.x+coopPlayers[coopSession].width/2,o=coopPlayers[coopSession].body.y+coopPlayers[coopSession].height/2,a=coopPlayers[coopSession].rotation;else var e=playerType.body.x+playerType.width/2,o=playerType.body.y+playerType.height/2,a=playerType.rotation;var s=Math.floor(40*Math.random()+-20),l=-0.2*Math.random()+.1,n=JSON.stringify({sessionid:io.socket.sessionid,rotation:a,nickname:playerName,resetX:e,resetY:o,bulletY:s,randVelocity:l});socket.emit("bulletChange",n)}}function explode(e,o){explosion=game.add.sprite(e,o,"explosion"),explosion.anchor.setTo(.5,.5),explosion.alpha=0,game.add.tween(explosion).to({alpha:1},100,Phaser.Easing.Linear.None,!0,0,100,!0),explosion.animations.add("explosion"),explosion.play("explosion","",!1,!0)}function newPlayer(e){console.log("New player data",e.lat);e.session,e.nickname,e.x,e.y,e.angle;players[e.session]=game.add.sprite(e.x,e.y,"otherPlayers"),players[e.session].anchor.setTo(.5,.5),game.physics.enable(players[e.session],Phaser.Physics.ARCADE),players[e.session].enableBody=!0,players[e.session].body.collideWorldBounds=!0,players[e.session].name=e.session,players[e.session].health=100,players[e.session].frame=1,players[e.session].angle=e.angle,players[e.session].body.immovable=!0,players[e.session].latitude=e.lat,players[e.session].longitude=e.long,players[e.session].coop=!1,players[e.session].coopPlayer="",players[e.session].inputEnabled=!0,players[e.session].events.onInputDown.add(clickedPlayer,this),"undefined"!=typeof e.coop&&e.coop===!0&&(players[e.session].visible=!1),playerGroup.add(players[e.session]),playerGroup.bringToTop(player)}function updatePlayer(e){{var o=(e.session,e.nickname);e.x,e.y,e.angle}"boss"===o?(boss.x=e.x,boss.y=e.y,boss.angle=e.angle):"coop"===o?(console.log("jajajajaja"),coopPlayers[e.session].x=e.x,coopPlayers[e.session].y=e.y,coopPlayers[e.session].angle=e.angle):(players[e.session].x=e.x,players[e.session].y=e.y,players[e.session].angle=e.angle)}function removePlayer(e){var o=e;o!==io.socket.sessionid&&(0!==Object.getOwnPropertyNames(coopPlayers).length?Object.keys(coopPlayers).forEach(function(e){e.indexOf(io.socket.sessionid)>-1&&(coopPlayers[e].kill(),player.visible=!0,player.allowControls=!0,player.move=!0,player.shoot=!0,player.enableBody=!0,game.camera.follow(playerType,Phaser.Camera.FOLLOW_TOPDOWN),coopMovement=!1,player.coop=!1,Object.keys(coopPlayers).forEach(function(o){o.indexOf(e)>-1&&delete coopPlayers[e]}))}):players[o].kill())}function newBullet(e){var o=bullets.getFirstDead();o&&(o.revive(),game.device.desktop&&(muzzleFlash=game.add.sprite(e.resetX,e.resetY,"muzzleFlash"),console.log(player.rotation),"left"==currentDirection?muzzleFlash.anchor.setTo(1.9,.4):"left-up"==currentDirection?muzzleFlash.anchor.setTo(2.2,2.1):"left-down"==currentDirection?muzzleFlash.anchor.setTo(2.2,-1.4):"right-up"==currentDirection?muzzleFlash.anchor.setTo(-1.2,2.1):"right-down"==currentDirection?muzzleFlash.anchor.setTo(-1.2,-1.2):"right"==currentDirection?muzzleFlash.anchor.setTo(-.9,.6):"down"==currentDirection?muzzleFlash.anchor.setTo(.5,-1):"up"==currentDirection?muzzleFlash.anchor.setTo(.5,1.9):muzzleFlash.anchor.setTo(.5,.5),muzzleFlash.alpha=0,game.add.tween(muzzleFlash).to({alpha:1},100,Phaser.Easing.Linear.None,!0,0,100,!0),muzzleFlash.lifespan=200),o.checkWorldBounds=!0,o.outOfBoundsKill=!0,o.reset(e.resetX,e.resetY),o.rotation=e.rotation,o.y+=e.bulletY,o.session=e.session,game.physics.arcade.velocityFromRotation(e.rotation+=e.randVelocity,625,o.body.velocity),o.animations.add("bulletCollide"),shakeScreen=15)}function changePosition(e,o,a,s,l,n){if("p"===n){if(""==o?o=0:o,""==s?s=0:s,"+"==e?playerType.body.velocity.x+=o:"-"==e?playerType.body.velocity.x-=o:playerType.body.velocity.x+=0,"+"==a?playerType.body.velocity.y+=s:"-"==a?playerType.body.velocity.y-=s:playerType.body.velocity.y+=0,playerType.angle=l,oldX!==playerType.x||oldY!==playerType.y){var r=JSON.stringify({sessionid:io.socket.sessionid,nickname:playerName,x:playerType.x,y:playerType.y,angle:playerType.angle});(diffNumbers(playerType.x,oldX)>=1||diffNumbers(playerType.y,oldY)>=1)&&(socket.emit("positionChange",r),oldX=playerType.x,oldY=playerType.y)}}else if(""==o?o=0:o,""==s?s=0:s,"+"==e?coopPlayers[n].body.velocity.x+=o:"-"==e?coopPlayers[n].body.velocity.x-=o:coopPlayers[n].body.velocity.x+=0,"+"==a?coopPlayers[n].body.velocity.y+=s:"-"==a?coopPlayers[n].body.velocity.y-=s:coopPlayers[n].body.velocity.y+=0,coopPlayers[n].angle=l,oldX!==coopPlayers[n].x||oldY!==coopPlayers[n].y){var r=JSON.stringify({sessionid:coopSession,nickname:"coop",x:coopPlayers[n].x,y:coopPlayers[n].y,angle:coopPlayers[n].angle});(diffNumbers(coopPlayers[n].x,oldX)>=1||diffNumbers(coopPlayers[n].y,oldY)>=1)&&(socket.emit("positionChange",r),oldX=coopPlayers[n].x,oldY=coopPlayers[n].y)}}function bulletBoss(e,o){bossIsDying||(o.session===io.socket.sessionid?(player.score+=10,textScore.setText("Score: "+player.score),console.log(currentDate()+" | Your bullet hit the Boss!")):console.log(currentDate()+" | A bullet hit the Boss!"),boss.damage(100),boss.frame=0,boss.health<=500&&boss.health>200?boss.tint=16750899:boss.health<=200&&boss.health>0?boss.tint=16711680:boss.health<=0&&(bossIsDying=!0,boss.tint=16777215,boss.alive=!0,boss.visible=!0,boss.exists=!0,boss.animations.add("boss"),boss.animations.play("boss",8,!1,!0),socket.emit("bossDied",io.socket.sessionid)),setTimeout(function(){boss.frame=1},100)),o.animations.play("bulletCollide"),o.events.onAnimationComplete.add(function(){o.kill()},this)}function bulletOtherPlayer(e,o){o.animations.play("bulletCollide"),curPlayerFrame=players[e.name].frame,players[e.name].frame=12,o.events.onAnimationComplete.add(function(){o.kill(),players[e.name].frame=curPlayerFrame},this);var a=players[e.name].name;socket.emit("damagePlayer",a),console.log(currentDate()+" | A bullet hit another player!"),players[e.name].damage(10),players[e.name].health<=0&&explode(players[e.name].x,players[e.name].y)}function bulletCoop(e,o){o.animations.play("bulletCollide"),o.events.onAnimationComplete.add(function(){o.kill()},this);var a=coopPlayers[e.name].name;socket.emit("damagePlayer",a),console.log("other player got hit!",a),coopPlayers[e.name].damage(10),coopPlayers[e.name].frame=0,setTimeout(function(){coopPlayers[e.name].frame=3},100)}function bulletPlayer(e,o){console.log(currentDate()+" | A bullet hit you!"),o.animations.play("bulletCollide"),o.events.onAnimationComplete.add(function(){o.kill()},this),player.health<=0&&explode(player.x,player.y)}function overlapPlayer(e){e.name===io.socket.sessionid&&(console.log("playerIsMinion",playerIsMinion),playerIsMinion||(playerIsMinion=!0))}function diagonalSpeed(e){var o=Math.sqrt(2*Math.pow(e,2))/2;return o}function createCloud(){var e=Math.floor(10*Math.random()+1),o=Math.floor(401*Math.random())+400;if(5>e)var a=game.add.sprite(-(Math.random()*o),game.world.randomY,"cloud1");else var a=game.add.sprite(-(Math.random()*o),game.world.randomY,"cloud2");a.angle=game.rnd.angle(),game.add.tween(a).to({x:game.width+(1600+a.x)},15e4,Phaser.Easing.Linear.None,!0),game.add.tween(a).to({angle:a.angle},15e4,Phaser.Easing.Linear.None,!0),cloudTimer=game.time.now+5e3,clouds.add(a)}function createStar(){var e=game.add.sprite(game.world.randomX,game.world.randomY,"star");e.angle=game.rnd.angle(),starTimer=game.time.now+5e3,stars.add(e)}function createMoon(){var e=game.world.randomY;300>e?e+=164:e>1700?e-=164:e=e,moon=game.add.sprite(-(400*Math.random()),e,"moon"),moon.angle=game.rnd.angle(),game.add.tween(moon).to({x:game.width+(1600+moon.x)},3e5,Phaser.Easing.Linear.None,!0)}function randName(){for(var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;10>a;a++)e+=o.charAt(Math.floor(Math.random()*o.length));return e}function diffNumbers(e,o){return Math.abs(e-o)}function currentDate(){var e=new Date,o=1==e.getMinutes().toString().length?"0"+e.getMinutes():e.getMinutes(),a=1==e.getSeconds().toString().length?"0"+e.getSeconds():e.getSeconds(),s=1==e.getHours().toString().length?"0"+e.getHours():e.getHours();return e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()+" "+s+":"+o+":"+a}function goFullscreen(){}function resizeGame(){var e=window.innerWidth,o=window.innerHeight;game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.width=e,game.height=o,game.stage.width=e,game.stage.height=o,game.scale.width=e,game.scale.height=o,game.renderType===Phaser.WEBGL?game.renderer.resize(e,o):game.renderType===Phaser.CANVAS&&(game.renderer.resize(e,o),Phaser.Canvas.setSmoothingEnabled(game.context,!1)),game.scale.setSize(),game.scale.refresh()}function newCoop(e,o,a,s,l,n,r,t){if("join"==t&&console.log(currentDate()+" | I am now in co-op mode with "+o+"."),coopSession="new"==t?e+o:o+e,console.log("player 1",e),console.log("player 2",o),console.log("coop session",coopSession),(e===io.socket.sessionid||o===io.socket.sessionid)&&(player.coop=!0),coopPlayers[coopSession]=game.add.sprite(game.world.centerX,game.world.centerY,"coop"),coopPlayers[coopSession].name=coopSession,coopPlayers[coopSession].player1=e,coopPlayers[coopSession].player2=o,coopPlayers[coopSession].coopSession=coopSession,coopPlayers[coopSession].move=s,coopPlayers[coopSession].shoot=a,coopPlayers[coopSession].anchor.setTo(.5,.5),coopPlayers[coopSession].enableBody=!0,game.physics.enable(coopPlayers[coopSession],Phaser.Physics.ARCADE),coopPlayers[coopSession].physicsBodyType=Phaser.Physics.ARCADE,coopPlayers[coopSession].health=250,coopPlayers[coopSession].frame=3,coopPlayers[coopSession].body.collideWorldBounds=!0,coopPlayers[coopSession].body.immovable=!0,""!==l&&""!==n&&""!==r&&(coopPlayers[coopSession].x=l,coopPlayers[coopSession].y=n,coopPlayers[coopSession].angle=r),coopPlayers[coopSession].move==io.socket.sessionid&&(console.log(currentDate()+" | You may move, good sir."),coopPlayers[coopSession].frame=2,coopMovement=!0,coopShooting=!1),coopPlayers[coopSession].shoot==io.socket.sessionid&&(console.log(currentDate()+" | You may shoot, good sir."),coopPlayers[coopSession].frame=1,coopShooting=!0,coopMovement=!1,player.move=!1),e==io.socket.sessionid?(console.log("jij bent player 1"),player.coop=!0,player.visible=!1,player.renderable=!1,player.allowControls=!1,player.move=!1,player.shoot=!1,player.enableBody=!1,players[o].visible=!1,players[o].coop=!0,players[o].renderable=!1,players[o].enableBody=!1,game.camera.follow(coopPlayers[coopSession])):o==io.socket.sessionid?(console.log("jij bent player 2"),player.coop=!0,player.visible=!1,player.renderable=!1,player.allowControls=!1,player.move=!1,player.shoot=!1,player.enableBody=!1,players[e].visible=!1,players[e].coop=!0,players[e].renderable=!1,players[e].enableBody=!1,game.camera.follow(coopPlayers[coopSession])):(console.log("jij bent geen van beide"),"undefined"!=typeof players[e]?(players[e].visible=!1,players[e].coop=!0,players[e].renderable=!1,players[e].enableBody=!1):console.log("player 1 bestaat niet"),"undefined"!=typeof players[o]?(players[o].visible=!1,players[o].coop=!0,players[o].renderable=!1,players[o].enableBody=!1):console.log("player 2 bestaat niet")),"new"===t){var i=JSON.stringify({player1:o,player2:e,move:o,shoot:e,x:coopPlayers[coopSession].x,y:coopPlayers[coopSession].y,angle:coopPlayers[coopSession].angle});socket.emit("newCoop",i)}}function compareGPS(e,o,a){if(""!==e&&""!==o){var s=distance(latitude,longitude,e,o,"k");s=1e3*s,a!=io.socket.sessionid?(console.log(currentDate()+" | Distance between YOU and "+a+" is: "+s.toString()+" meters."),player.coop===!1?(console.log(currentDate()+" | Ik ben nog niet in co-op modus"),players[a].coop===!1&&(console.log(currentDate()+" | "+a+" is ook nog niet in co-op modus"),newCoop(player.name,players[a].name,players[a].name,player.name,"","","","new"))):console.log("NEEEEEEEEEEEEEEEEEEEEEEE")):console.log(currentDate()+" | Distance between YOU and "+players[a].name+" ("+s+") is greater than the given range ("+range+").")}}function getLocation(){navigator.geolocation?navigator.geolocation.watchPosition(foundPosition,function(e){console.log("Error",e),e.code==e.PERMISSION_DENIED&&(latitude=0,longitude=0)},{enableHighAccuracy:!1}):console.log("Het ophalen van uw locatie is mislukt\nGPS wordt niet ondersteund op uw smart device.")}function foundPosition(e){if(e.coords.latitude!==latitude||e.coords.longitude!==longitude){latitude=e.coords.latitude,longitude=e.coords.longitude;var o=JSON.stringify({sessionid:io.socket.sessionid,lat:latitude,"long":longitude});socket.emit("locationUpdate",o)}}function distance(e,o,a,s,l){var n=Math.PI*e/180,r=Math.PI*a/180,t=(Math.PI*o/180,Math.PI*s/180,o-s),i=Math.PI*t/180,c=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(i);return c=Math.acos(c),c=180*c/Math.PI,c=60*c*1.1515,"K"==l&&(c=1.609344*c),"N"==l&&(c=.8684*c),c}function clickedPlayer(e){compareGPS(players[e.name].latitude,players[e.name].longitude,players[e.name].name)}function tapped(){console.log("tapped!")}function render(){}var w=window.innerWidth,h=window.innerHeight,game=new Phaser.Game(w,h,Phaser.AUTO,"",{preload:preload,create:create,update:update,render:render});WebFontConfig={active:function(){game.time.events.add(Phaser.Timer.SECOND,createText,this)},google:{families:["Press Start 2P"]}};var io=io.connect("",{rememberTransport:!1,transports:["WebSocket","Flash Socket","AJAX long-polling"]}),player,boss,players={},coopPlayers={},playerName,onlinePlayers=[],cursors,fireButton,bullets,currentDirection,bulletsCount=20,bulletTime=0,textPlayers,curPlayerFrame,textScore,oldX=0,oldY=0,movementSpeed=350,diagonalSpeed,vibrate=!1,shakeScreen=0,bossHealth=100,muzzleFlash,playerType,bossIsDying=!1,playerIsMinion=!1,playerGroup,bgtile,clouds,cloudTimer=0,stars,starTimer=0,moon,playerBullet,backgroundMusic,latitude,longitude,range=500,coop,coopMovement=!1,coopShooting=!1,logging=!0;